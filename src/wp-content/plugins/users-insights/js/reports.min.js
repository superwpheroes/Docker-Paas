var usinReportsApp=angular.module("usinReportsApp",["ngMaterial","ui.select"],usinHelpers.config.httpProvider).config(usinHelpers.config.animateProvider).config(usinHelpers.config.mdThemingProvider).value("options",{}).run(["options",function(a){angular.copy(window.USIN,a)}]);angular.module("usinReportsApp").filter("group",function(){return function(a,b){var c=a.filter(function(a){return a.group===b.id});return c}}),USIN.chartCtrl=function(a,b){var c,d=b[0].getElementsByTagName("canvas")[0],e=this;this.$onChanges=function(a){a.chartOptions&&e.chartOptions&&(c&&"function"==typeof c.destroy&&c.destroy(),e.initChart())},this.initChart=function(){c=new Chart(d.getContext("2d"),e.chartOptions)}},usinReportsApp.component("usinChart",{templateUrl:USIN.viewsURL+"/chart.html",bindings:{chartOptions:"<"},controller:["$scope","$element",USIN.chartCtrl]}),USIN.mainCtrl=function(a,b){function c(){var a=f.get(e);if(a){var b=g.reportGroups.filter(function(b){return b.id===a});if(b.length>0)return b[0]}return g.reportGroups[0]}function d(a){g.currentGroup=a,f.set(e,a.id)}var e="report_group",f=usinHelpers.session,g=this;this.reports=a.reports,this.reportGroups=a.reportGroups,this.currentGroup=c(),this.strings=a.strings,this.changeGroup=function(a){b.clearQueue(),d(a)},this.changeReportVisibility=function(a,b){a.visible=b},this.findReportById=function(a){return this.reports.filter(function(b){return b.id===a})[0]}},usinReportsApp.component("usinMain",{templateUrl:USIN.viewsURL+"/main.html",controller:["options","UsinReportQuery",USIN.mainCtrl]}),USIN.reportCtrl=function(a,b){var c=this;this.displayed=!1,this.strings=b.strings,this.toggleMenu=function(){c.displayed=!c.displayed},this.onCheckboxChange=function(b){var d=!b.visible;c.onVisibilityChange({report:b,newVisibility:d}),a.updateReportVisiblity(b,d)}},usinReportsApp.component("usinReportToggle",{templateUrl:USIN.viewsURL+"/report-toggle.html",bindings:{reports:"<",group:"<",onVisibilityChange:"&"},controller:["UsinReportQuery","options",USIN.reportCtrl]}),USIN.reportCtrl=function(a,b,c){var d=this;this.loading=!0,this.chartOptions=null,this.error=null,this.loadData=function(){this.error=null,this.loading=!0,a.getReport(this.getQueryArgs()).then(function(a){d.chartOptions=b.format(a.data,d.reportOptions)},function(a){d.error=a.data&&a.data.error||c.strings.errorLoading})["finally"](function(){d.loading=!1})},this.getQueryArgs=function(){var a={report_id:this.reportOptions.id};return this.hasFilters()&&(a.filter=this.filter),a},this.hasFilters=function(){return"undefined"!=typeof this.reportOptions.filters},this.hasFilters()&&(this.filter=this.reportOptions.filters["default"]),this.onFilterChange=function(){this.loadData()},this.shouldEnableSearch=function(){return this.hasFilters()&&Object.keys(this.reportOptions.filters.options).length>10},this.loadData()},usinReportsApp.component("usinReport",{templateUrl:USIN.viewsURL+"/report.html",bindings:{reportOptions:"<"},controller:["UsinReportQuery","UsinReportData","options",USIN.reportCtrl]}),usinReportsApp.factory("UsinReportData",["options",function(a){function b(a,b){var c=[];if(b)for(var d=0;d<a.length;d++)c.push(b);else c=e.slice(0,a.length);var f={labels:[],datasets:[{backgroundColor:c,data:[]}]};return a.forEach(function(a){f.labels.push(a.label),f.datasets[0].data.push(a.total)}),f}function c(a,c){var d="periodic"==c.subtype?"#00aba8":null,e={type:"bar",data:b(a,d),options:{legend:{display:!1},scales:{xAxes:[{gridLines:{color:"rgba(0, 0, 0, 0.03)"},ticks:{autoSkip:!1,callback:function(a){var b=16;return a.length>=b?a.slice(0,a.length).substring(0,b-1).trim()+"..":a}}}],yAxes:[{ticks:{beginAtZero:!0,userCallback:function(a,b,c){return Math.floor(a)===a?a:void 0}},gridLines:{color:"rgba(0, 0, 0, 0.03)"}}]},tooltips:{callbacks:{title:function(a){return this._data.labels[a[0].index]}}}}};return c.format&&"float"==c.format&&(e.options.tooltips.callbacks.label=function(a){var b=parseFloat(a.yLabel);return!isNaN(b)&&isFinite(b)?b.toFixed(2):b}),a.length<=3&&(e.options.scales.xAxes[0].barThickness=50),e}function d(c,d){var e=null,f=!0;return c.length||(c=[{total:1,label:a.strings.noResults}],e="#dddddd",f=!1),{type:"doughnut",data:b(c,e),options:{legend:{labels:{boxWidth:12,filter:function(a,b){return a.index<5?a:void 0}},display:!0},tooltips:{enabled:f}}}}var e=["#00aba8","#1aa6c9","#f05d5d","#eb5b95","#fcb867","#a379db","#43adde","#38ba8d","#5669e3","#f05d91","#fa8f5a","#7ecf65"];return{format:function(a,b){return a instanceof Array||(a=[]),"bar"==b.type?c(a,b):"pie"==b.type?d(a,b):void 0}}}]),usinReportsApp.factory("UsinReportQuery",["options","$http","$cacheFactory","$q",function(a,b,c,d){var e=c("lru",{capacity:100}),f=[],g=function(){var a=f[0];b(a.config).then(function(b){a.deferred.resolve(b)},function(b){a.deferred.reject(b)})["finally"](function(){f.shift(),f.length>0&&g()})};return{getReport:function(b){var c=d.defer(),h={method:"get",url:a.ajaxURL,params:angular.extend({action:"usin_get_report",nonce:a.nonce},b),cache:e};return f.push({config:h,deferred:c}),1===f.length&&g(),c.promise},clearQueue:function(){f=[]},updateReportVisiblity:function(c,d){var e={action:"usin_update_report_visibility",nonce:a.nonce,report_id:c.id,visibility:d};return b({method:"post",url:a.ajaxURL,data:e})}}}]);
//# sourceMappingURL=reports.min.js.map