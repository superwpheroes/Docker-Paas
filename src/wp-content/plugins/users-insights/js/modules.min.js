var usinModuleApp=angular.module("usinModuleApp",["usinPartials"],usinHelpers.config.httpProvider).config(usinHelpers.config.animateProvider).config(usinHelpers.config.mdThemingProvider).value("options",{}).run(["options",function(a){var b=window.USIN;a.viewsURL=b.viewsURL,a.ajaxURL=b.ajaxURL,a.nonce=b.nonce,a.modules=b.modules,a.strings=b.strings}]);usinModuleApp.filter("moduleActive",function(){return function(a,b){for(var c=[],d=0,e=a.length;e>d;d++)a[d].active===b&&c.push(a[d]);return c}}),usinModuleApp.controller("UsinMainCtrl",["$scope","options",function(a,b){a.modules=b.modules,a.strings=b.strings,a.getModule=function(b){for(var c=0,d=a.modules.length;d>c;c++)if(a.modules[c].id==b)return a.modules[c]}}]).controller("UsinModuleCtrl",["$scope","options","UsinModuleQuery","$window",function(a,b,c,d){a.moduleLoading=!1,a.moduleSuccess=!1,a.settingsButton=null,a.setStatusEdit=function(){a.state="edit"},a.setStatusDefault=function(){a.state="default"},a.onActivateClick=function(){var b=!1;if((a.module.requires_license&&!a.module.uses_module_license&&a.module.license.activated||!a.module.requires_license)&&(b=!0),a.module.uses_module_license){var f=a.getModule(a.module.uses_module_license);f&&f.license.activated&&(b=!0)}b?(a.moduleError="",a.moduleLoading=!0,c.activateModule(a.module.id).then(function(){var b=usinHelpers.url.addParam(d.location.href,"usin_module_activated",a.module.id);d.location.href=b},e)["finally"](function(){a.moduleLoading=!1})):a.setStatusEdit()},a.onDeactivateClick=function(){a.moduleLoading=!0,c.deactivateModule(a.module.id).then(function(){d.location.reload()},e)["finally"](function(){a.moduleLoading=!1})},a.updateSettings=function(){a.moduleLoading=!0,a.moduleSuccess=!1,c.updateSettings(a.module.id,a.module.settings).then(function(b){a.moduleSuccess=!0},e)["finally"](function(){a.moduleLoading=!1})},a.onSettingsBtnClick=function(){a.settingsButton.onClick.call()},a.$watch("state",function(){if(a.moduleSuccess=!1,a.moduleError=!1,a.moduleLoading=!1,a.module.has_options){var c={text:b.strings.settings,onClick:a.setStatusEdit};"edit"==a.state&&(a.module.settings?(c.text=b.strings.saveChanges,c.onClick=a.updateSettings):c.disabled=!0),a.settingsButton=c}}),a.state="default";var e=function(b){a.moduleError=b.data&&b.data.error||a.strings.errorRequest}}]).controller("UsinLicenseCtrl",["$scope","UsinModuleQuery",function(a,b){a.successMsg="",a.errorMsg="",a.licenseLoading=!1,a.licenseSet=function(){return a.module.license.activated},a.addLicense=function(){var e=a.module.license.key;e&&(a.licenseLoading=!0,b.addLicense(a.module.id,e).then(function(b){d(a.strings.licenseActivated),a.module.license=b.data},c)["finally"](function(){a.licenseLoading=!1}))},a.deactivateLicense=function(){var e=a.module.license.key;a.licenseLoading=!0,b.deactivateLicense(a.module.id,e).then(function(b){d(a.strings.licenseDeactivated),a.module.license=b.data},c)["finally"](function(){a.licenseLoading=!1})},a.refreshLicense=function(){a.licenseLoading=!0,b.refreshLicenseStatus(a.module.id).then(function(b){d(""),a.module.license=b.data},c)["finally"](function(){a.licenseLoading=!1})};var c=function(b){a.errorMsg=b.data&&b.data.error||a.strings.errorRequest,a.successMsg=""},d=function(b){a.successMsg=b,a.errorMsg=""}}]).controller("UsinSettingsCtrl",["$scope","UsinModuleQuery",function(a,b){}]),usinModuleApp.directive("usinMain",["options",function(a){return{restrict:"EAC",templateUrl:a.viewsURL+"/main.html",controller:"UsinMainCtrl"}}]).directive("usinModule",["options",function(a){return{restrict:"EAC",templateUrl:a.viewsURL+"/module.html",controller:"UsinModuleCtrl"}}]).directive("usinLicense",["options",function(a){return{restrict:"EAC",templateUrl:a.viewsURL+"/license.html",controller:"UsinLicenseCtrl"}}]).directive("usinSettings",["options",function(a){return{restrict:"EAC",templateUrl:a.viewsURL+"/settings.html",controller:"UsinSettingsCtrl"}}]),usinModuleApp.factory("UsinModuleQuery",["options","$http",function(a,b){return{addLicense:function(c,d){var e=usinHelpers.url.addParam(a.ajaxURL,"action","usin_add_license"),f={module_id:c,license_key:d,nonce:a.nonce};return b({method:"post",url:e,data:f})},deactivateLicense:function(c,d){var e=usinHelpers.url.addParam(a.ajaxURL,"action","usin_deactivate_license"),f={module_id:c,license_key:d,nonce:a.nonce};return b({method:"post",url:e,data:f})},activateModule:function(c){var d=usinHelpers.url.addParam(a.ajaxURL,"action","usin_activate_module"),e={module_id:c,nonce:a.nonce};return b({method:"post",url:d,data:e})},deactivateModule:function(c){var d=usinHelpers.url.addParam(a.ajaxURL,"action","usin_deactivate_module"),e={module_id:c,nonce:a.nonce};return b({method:"post",url:d,data:e})},refreshLicenseStatus:function(c){var d=usinHelpers.url.addParam(a.ajaxURL,"action","usin_refresh_license_status"),e={module_id:c,nonce:a.nonce};return b({method:"post",url:d,data:e})},updateSettings:function(c,d){var e=usinHelpers.url.addParam(a.ajaxURL,"action","usin_update_module_settings"),f={module_id:c,nonce:a.nonce},g={};for(var h in d)d.hasOwnProperty(h)&&(g[h]=d[h].value);return f.settings=angular.toJson(g),b({method:"post",url:e,data:f})}}}]);
//# sourceMappingURL=modules.min.js.map